"use strict";(function(a,b){"function"==typeof define&&define.amd?define([],b):"object"==typeof module&&module.exports?module.exports=b():a.pureknob=b()})("undefined"==typeof self?this:self,function(){return new function(){this.createBarGraph=function(a,b){const c=b.toString(),d=a.toString(),e=document.createElement("canvas"),f=document.createElement("div");f.style.display="inline-block",f.style.height=c+"px",f.style.position="relative",f.style.textAlign="center",f.style.width=d+"px",f.appendChild(e);const g={_canvas:e,_div:f,_height:b,_width:a,_properties:{colorBG:"#181818",colorFG:"#ff8800",colorMarkers:"#888888",markerStart:0,markerEnd:100,markerStep:20,trackWidth:.5,valMin:0,valMax:100,valPeaks:[],val:0},getPeaks:function(){const a=this._properties,b=a.valPeaks,c=b.length,d=[];for(let a=0;a<c;a++){const c=b[a];d.push(c)}return d},getProperty:function(a){const b=this._properties,c=b[a];return c},getValue:function(){const a=this._properties,b=a.val;return b},node:function(){const a=this._div;return a},redraw:function(){this.resize();const a=this._properties,b=a.colorBG,c=a.colorFG,d=a.colorMarkers,e=a.markerStart,f=a.markerEnd,g=a.markerStep,h=a.trackWidth,j=a.valMin,k=a.valMax,l=a.valPeaks,m=a.val,n=this._height,o=this._width,p=Math.round(h*n),q=.5*p,r=.5*n,s=r-q,t=l.length,u=this._canvas,w=u.getContext("2d");if(w.clearRect(0,0,o,n),null!==e&null!==f&null!==g&0!==g){w.lineCap="butt",w.lineWidth="2",w.strokeStyle=d;for(let a=e;a<=f;a+=g){const b=(a-j)/(k-j),c=Math.round(o*b);w.beginPath(),w.moveTo(c,0),w.lineTo(c,n),w.stroke()}}w.beginPath(),w.rect(0,s,o,p),w.fillStyle=b,w.fill(),w.beginPath(),w.rect(0,s,o*((m-j)/(k-j)),p),w.fillStyle=c,w.fill(),w.strokeStyle=c;for(let a=0;a<t;a++){const b=l[a],c=Math.round(o*((b-j)/(k-j)));w.beginPath(),w.moveTo(c,s),w.lineTo(c,r+q),w.stroke()}},resize:function(){const a=this._canvas;a.style.height="100%",a.style.width="100%",a.height=this._height,a.width=this._width},setPeaks:function(a){const b=this._properties,c=[],d=a.length;for(let b=0;b<d;b++){const d=a[b];c.push(d)}this.setProperty("valPeaks",c)},setProperty:function(a,b){this._properties[a]=b,this.redraw()},setValue:function(a){const b=this._properties,c=b.valMin,d=b.valMax;a<c?a=c:a>d&&(a=d),a=Math.round(a),this.setProperty("val",a)}};return e.addEventListener("resize",function(){g.redraw()}),g},this.createKnob=function(a,b){const c=b.toString(),d=a.toString(),e=a<b?a:b,f=(.2*e).toString(),g=document.createElement("canvas"),h=document.createElement("div");h.style.display="inline-block",h.style.height=c+"px",h.style.position="relative",h.style.textAlign="center",h.style.width=d+"px",h.appendChild(g);const i=document.createElement("input");i.style.appearance="textfield",i.style.backgroundColor="rgba(0, 0, 0, 0.8)",i.style.border="none",i.style.color="#ff8800",i.style.fontFamily="sans-serif",i.style.fontSize=f+"px",i.style.height=c+"px",i.style.margin="auto",i.style.padding="0px",i.style.textAlign="center",i.style.width=d+"px";const j=document.createAttribute("inputmode");j.value="numeric",i.setAttributeNode(j);const k=document.createElement("div");k.style.bottom="0px",k.style.display="none",k.style.left="0px",k.style.position="absolute",k.style.right="0px",k.style.top="0px",k.appendChild(i),h.appendChild(k);const l={_canvas:g,_div:h,_height:b,_input:i,_inputDiv:k,_listeners:[],_mousebutton:!1,_previousVal:0,_timeout:null,_timeoutDoubleTap:null,_touchCount:0,_width:a,_notifyUpdate:function(){const a=this._properties,b=a.val,c=this._listeners,d=c.length;for(let a=0;a<d;a++){const d=c[a];null!==d&&d(this,b)}},_properties:{angleEnd:2*Math.PI,angleOffset:-.5*Math.PI,angleStart:0,colorBG:"#181818",colorFG:"#ff8800",colorLabel:"#ffffff",fnStringToValue:function(a){return parseInt(a)},fnValueToString:function(a){return a.toString()},label:null,needle:!1,readonly:!1,textScale:1,trackWidth:.4,valMin:0,valMax:100,val:0},abort:function(){const a=this._previousVal,b=this._properties;b.val=a,this.redraw()},addListener:function(a){const b=this._listeners;b.push(a)},commit:function(){const a=this._properties,b=a.val;this._previousVal=b,this.redraw(),this._notifyUpdate()},getProperty:function(a){const b=this._properties,c=b[a];return c},getValue:function(){const a=this._properties,b=a.val;return b},node:function(){const a=this._div;return a},redraw:function(){this.resize();const a=this._properties,b=a.needle,c=a.angleStart,d=a.angleOffset,e=a.angleEnd,f=c+d,g=a.label,h=a.val,i=a.fnValueToString,j=i(h),k=a.valMin,l=a.valMax,m=f+(h-k)/(l-k)*(e-c),n=a.colorBG,o=a.colorFG,p=a.colorLabel,q=a.textScale,r=a.trackWidth,s=this._height,t=this._width,u=t<s?t:s,v=.5*t,w=.5*s,x=.4*u,y=Math.round(r*x),z=Math.round(.8*y),A=z.toString(),B=(.2*u*q).toString(),C=this._canvas,D=C.getContext("2d");D.clearRect(0,0,t,s),D.beginPath(),D.arc(v,w,x,f,e+d),D.lineCap="butt",D.lineWidth=y,D.strokeStyle=n,D.stroke(),D.beginPath(),b?D.arc(v,w,x,m-.1,m+.1):D.arc(v,w,x,f,m),D.lineCap="butt",D.lineWidth=y,D.strokeStyle=o,D.stroke(),D.font=B+"px sans-serif",D.fillStyle=o,D.textAlign="center",D.textBaseline="middle",D.fillText(j,v,w),null!==g&&(D.font=A+"px sans-serif",D.fillStyle=p,D.textAlign="center",D.textBaseline="middle",D.fillText(g,v,w+x));const E=this._input;E.style.color=o,E.style.fontSize=B+"px"},resize:function(){const a=this._canvas;a.style.height="100%",a.style.width="100%",a.height=this._height,a.width=this._width},setProperty:function(a,b){this._properties[a]=b,this.redraw()},setValue:function(a){this.setValueFloating(a),this.commit()},setValueFloating:function(a){const b=this._properties,c=b.valMin,d=b.valMax;a<c?a=c:a>d&&(a=d),a=Math.round(a),this.setProperty("val",a)}},m=function(a,b){const c=a.target,d=c.scrollWidth,e=c.scrollHeight,f=a.offsetX,g=a.offsetY,h=b.angleStart,i=b.angleEnd,j=i-h;let k=Math.atan2(f-.5*d,-(g-.5*e))-h;const l=2*Math.PI;0>k&&(j>=l?k+=l:k=0);const m=b.valMin,n=b.valMax;let o=k/j*(n-m)+m;return o<m?o=m:o>n&&(o=n),o},n=function(a,b){const c=a.target,d=c.getBoundingClientRect(),e=d.left,f=d.top,g=c.scrollWidth,h=c.scrollHeight,i=a.targetTouches;let j=null;0<i.length&&(j=i.item(0));let k=0,l=0;if(null!==j){const a=j.pageX;k=a-e;const b=j.pageY;l=b-f}const m=k-.5*g,n=l-.5*h,o=b.angleStart,p=b.angleEnd,q=p-o,r=2*Math.PI;let s=Math.atan2(m,-n)-o;0>s&&(q>=r?s+=r:s=0);const t=b.valMin,u=b.valMax;let v=s/q*(u-t)+t;return v<t?v=t:v>u&&(v=u),v};return g.addEventListener("dblclick",function(a){const b=l._properties,c=b.readonly;if(!c){a.preventDefault();const b=l._inputDiv;b.style.display="block";const c=l._input;c.focus(),l.redraw()}}),g.addEventListener("mousedown",function(a){const b=a.buttons;if(1===b){const b=l._properties,c=b.readonly;if(!c){a.preventDefault();const c=m(a,b);l.setValueFloating(c)}l._mousebutton=!0}if(4===b){const b=l._properties,c=b.readonly;if(!c){a.preventDefault();const b=l._inputDiv;b.style.display="block";const c=l._input;c.focus(),l.redraw()}}}),g.addEventListener("mouseleave",function(){const a=l._mousebutton;a&&(l.abort(),l._mousebutton=!1)}),g.addEventListener("mousemove",function(a){const b=l._mousebutton;if(b){const b=l._properties,c=b.readonly;if(!c){a.preventDefault();const c=m(a,b);l.setValueFloating(c)}}}),g.addEventListener("mouseup",function(a){const b=l._mousebutton;if(b){const b=l._properties,c=b.readonly;if(!c){a.preventDefault();const c=m(a,b);l.setValue(c)}}l._mousebutton=!1}),g.addEventListener("resize",function(){l.redraw()}),g.addEventListener("touchstart",function(a){const b=l._properties,c=b.readonly;if(!c){const c=a.targetTouches,d=c.length;if(1===d){if(l._mousebutton=!0,0===l._touchCount){let b=l._timeoutDoubleTap;window.clearTimeout(b),b=window.setTimeout(function(){if(2===l._touchCount){const b=l._properties,c=b.readonly;if(!c){a.preventDefault();const b=l._inputDiv;b.style.display="block";const c=l._input;c.focus(),l.redraw()}}l._touchCount=0},500),l._timeoutDoubleTap=b}l._touchCount++;const c=n(a,b);l.setValueFloating(c)}}}),g.addEventListener("touchmove",function(a){const b=l._mousebutton;if(b){const b=l._properties,c=b.readonly;if(!c){const c=a.targetTouches,d=c.length;if(1===d){a.preventDefault();const c=n(a,b);l.setValueFloating(c)}}}}),g.addEventListener("touchend",function(a){const b=l._mousebutton;if(b){const b=l._properties,c=b.readonly;if(!c){const b=a.targetTouches,c=b.length;0===c&&(a.preventDefault(),l._mousebutton=!1,l.commit())}}l._mousebutton=!1}),g.addEventListener("touchcancel",function(){const a=l._mousebutton;if(a){l.abort(),l._touchCount=0;const a=l._timeoutDoubleTap;window.clearTimeout(a)}l._mousebutton=!1}),g.addEventListener("wheel",function(a){const b=l.getProperty("readonly");if(!b){a.preventDefault();const b=a.deltaY,c=0<b?1:0>b?-1:0;let d=l.getValue();d+=c,l.setValueFloating(d);let e=l._timeout;window.clearTimeout(e),e=window.setTimeout(function(){l.commit()},250),l._timeout=e}}),i.addEventListener("keypress",function(a){const b=a.keyCode;if(13===b||27===b){const c=l._inputDiv;c.style.display="none";const d=a.target;if(13===b){const a=l._properties,b=d.value,c=a.fnStringToValue,e=c(b),f=isFinite(e);f&&l.setValue(e)}d.value=""}}),l}}});