<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Document</title>


	<style>body{padding:0;margin:0;overflow-x:hidden}#wrapper{font-family:Arial,sans-serif;color:#444;font-weight:600;width:100vw;height:100vh;user-select:none;overflow:hidden}#top-bar{position:fixed;background-color:#fefefe;border-bottom:solid 1px #eee;width:100vw;height:60px;z-index:1;padding-bottom:0}#tab-bar{position:absolute;width:100vw;height:20px;background-color:#fefefe;border-top:solid 1px #ede;z-index:1;top:60px;left:0;padding:0;margin:0;display:flex;flex-direction:row;align-items:center;overflow:hidden}.tab-button{outline:0;background-color:#eee;margin:0;border:none;padding:0;height:100%;width:100%;min-width:fit-content;max-width:10%;padding-left:3px;padding-right:3px;color:#333;font-weight:600;border-top-left-radius:5px;border-top-right-radius:5px;border-top:solid 1px #bbb;border-left:solid 1px #bbb;border-right:solid 1px #bbb}.tab-button-disabled{background-color:#ccc}.tab-button:active{background-color:#ccc}#title{text-align:left;color:#444;width:100%;margin-left:15px;margin-top:12px;font-weight:700;font-size:20px}#info{text-align:left;font-size:12px;margin-left:15px}#isConnected{position:fixed;top:10px;right:15px;font-size:18px}#content{position:fixed;top:0;bottom:0;width:100vw;overflow-y:scroll;overflow-x:scroll}@media screen and (min-width:768px){#isConnected{font-size:30px;right:20px}#title{text-align:center;font-size:30px}#info{text-align:center;margin-left:40px}}@media screen and (min-width:1024px){#isConnected{right:45px}}
.c-wrapper{-webkit-touch-callout:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;z-index:1}.slider{-webkit-appearance:none;-moz-appearance:none;outline:0;border-radius:4px}.slider::-moz-range-thumb{-moz-appearance:none;border-radius:50%;background:#4caf50;cursor:pointer}.slider::-webkit-slider-thumb{-webkit-appearance:none;appearance:none;border-radius:50%;background:#4caf50;cursor:pointer}.sliderValueWrapper{padding:0;margin:0}.inner-led{position:relative;border-radius:50%;z-index:2}.outer-led{z-index:1;display:flex;align-items:center;justify-content:center;border-radius:50%;position:absolute;margin:30px}.input{border:none;outline:0}.input:focus{border-bottom:solid 2px #444}.input::-webkit-input-placeholder{opacity:.5}.input::-moz-placeholder{opacity:.5}::-moz-progress-bar{background-color:red}.button{outline:0;border:none;border-radius:5px}.progress-bar{-webkit-appearance:none;-moz-appearance:none;border-radius:3px}.color-field{z-index:0}


		
	</style>


</head>
<body>
  <div id="wrapper">
    <div id="top-bar">  
      <div id="title">Loading...</div>
      <div id="info">If it takes too long - refresh website</div>
      <div id="isConnected"></div>
    </div>
    <div id="tab-bar">

    </div>
    <div id="content"></div>
  </div>

	<script>"use strict";(function(a,b){"function"==typeof define&&define.amd?define([],b):"object"==typeof module&&module.exports?module.exports=b():a.pureknob=b()})("undefined"==typeof self?this:self,function(){return new function(){this.createBarGraph=function(a,b){const c=b.toString(),d=a.toString(),e=document.createElement("canvas"),f=document.createElement("div");f.style.display="inline-block",f.style.height=c+"px",f.style.position="relative",f.style.textAlign="center",f.style.width=d+"px",f.appendChild(e);const g={_canvas:e,_div:f,_height:b,_width:a,_properties:{colorBG:"#181818",colorFG:"#ff8800",colorMarkers:"#888888",markerStart:0,markerEnd:100,markerStep:20,trackWidth:.5,valMin:0,valMax:100,valPeaks:[],val:0},getPeaks:function(){const a=this._properties,b=a.valPeaks,c=b.length,d=[];for(let a=0;a<c;a++){const c=b[a];d.push(c)}return d},getProperty:function(a){const b=this._properties,c=b[a];return c},getValue:function(){const a=this._properties,b=a.val;return b},node:function(){const a=this._div;return a},redraw:function(){this.resize();const a=this._properties,b=a.colorBG,c=a.colorFG,d=a.colorMarkers,e=a.markerStart,f=a.markerEnd,g=a.markerStep,h=a.trackWidth,j=a.valMin,k=a.valMax,l=a.valPeaks,m=a.val,n=this._height,o=this._width,p=Math.round(h*n),q=.5*p,r=.5*n,s=r-q,t=l.length,u=this._canvas,w=u.getContext("2d");if(w.clearRect(0,0,o,n),null!==e&null!==f&null!==g&0!==g){w.lineCap="butt",w.lineWidth="2",w.strokeStyle=d;for(let a=e;a<=f;a+=g){const b=(a-j)/(k-j),c=Math.round(o*b);w.beginPath(),w.moveTo(c,0),w.lineTo(c,n),w.stroke()}}w.beginPath(),w.rect(0,s,o,p),w.fillStyle=b,w.fill(),w.beginPath(),w.rect(0,s,o*((m-j)/(k-j)),p),w.fillStyle=c,w.fill(),w.strokeStyle=c;for(let a=0;a<t;a++){const b=l[a],c=Math.round(o*((b-j)/(k-j)));w.beginPath(),w.moveTo(c,s),w.lineTo(c,r+q),w.stroke()}},resize:function(){const a=this._canvas;a.style.height="100%",a.style.width="100%",a.height=this._height,a.width=this._width},setPeaks:function(a){const b=this._properties,c=[],d=a.length;for(let b=0;b<d;b++){const d=a[b];c.push(d)}this.setProperty("valPeaks",c)},setProperty:function(a,b){this._properties[a]=b,this.redraw()},setValue:function(a){const b=this._properties,c=b.valMin,d=b.valMax;a<c?a=c:a>d&&(a=d),a=Math.round(a),this.setProperty("val",a)}};return e.addEventListener("resize",function(){g.redraw()}),g},this.createKnob=function(a,b){const c=b.toString(),d=a.toString(),e=a<b?a:b,f=(.2*e).toString(),g=document.createElement("canvas"),h=document.createElement("div");h.style.display="inline-block",h.style.height=c+"px",h.style.position="relative",h.style.textAlign="center",h.style.width=d+"px",h.appendChild(g);const i=document.createElement("input");i.style.appearance="textfield",i.style.backgroundColor="rgba(0, 0, 0, 0.8)",i.style.border="none",i.style.color="#ff8800",i.style.fontFamily="sans-serif",i.style.fontSize=f+"px",i.style.height=c+"px",i.style.margin="auto",i.style.padding="0px",i.style.textAlign="center",i.style.width=d+"px";const j=document.createAttribute("inputmode");j.value="numeric",i.setAttributeNode(j);const k=document.createElement("div");k.style.bottom="0px",k.style.display="none",k.style.left="0px",k.style.position="absolute",k.style.right="0px",k.style.top="0px",k.appendChild(i),h.appendChild(k);const l={_canvas:g,_div:h,_height:b,_input:i,_inputDiv:k,_listeners:[],_mousebutton:!1,_previousVal:0,_timeout:null,_timeoutDoubleTap:null,_touchCount:0,_width:a,_notifyUpdate:function(){const a=this._properties,b=a.val,c=this._listeners,d=c.length;for(let a=0;a<d;a++){const d=c[a];null!==d&&d(this,b)}},_properties:{angleEnd:2*Math.PI,angleOffset:-.5*Math.PI,angleStart:0,colorBG:"#181818",colorFG:"#ff8800",colorLabel:"#ffffff",fnStringToValue:function(a){return parseInt(a)},fnValueToString:function(a){return a.toString()},label:null,needle:!1,readonly:!1,textScale:1,trackWidth:.4,valMin:0,valMax:100,val:0},abort:function(){const a=this._previousVal,b=this._properties;b.val=a,this.redraw()},addListener:function(a){const b=this._listeners;b.push(a)},commit:function(){const a=this._properties,b=a.val;this._previousVal=b,this.redraw(),this._notifyUpdate()},getProperty:function(a){const b=this._properties,c=b[a];return c},getValue:function(){const a=this._properties,b=a.val;return b},node:function(){const a=this._div;return a},redraw:function(){this.resize();const a=this._properties,b=a.needle,c=a.angleStart,d=a.angleOffset,e=a.angleEnd,f=c+d,g=a.label,h=a.val,i=a.fnValueToString,j=i(h),k=a.valMin,l=a.valMax,m=f+(h-k)/(l-k)*(e-c),n=a.colorBG,o=a.colorFG,p=a.colorLabel,q=a.textScale,r=a.trackWidth,s=this._height,t=this._width,u=t<s?t:s,v=.5*t,w=.5*s,x=.4*u,y=Math.round(r*x),z=Math.round(.8*y),A=z.toString(),B=(.2*u*q).toString(),C=this._canvas,D=C.getContext("2d");D.clearRect(0,0,t,s),D.beginPath(),D.arc(v,w,x,f,e+d),D.lineCap="butt",D.lineWidth=y,D.strokeStyle=n,D.stroke(),D.beginPath(),b?D.arc(v,w,x,m-.1,m+.1):D.arc(v,w,x,f,m),D.lineCap="butt",D.lineWidth=y,D.strokeStyle=o,D.stroke(),D.font=B+"px sans-serif",D.fillStyle=o,D.textAlign="center",D.textBaseline="middle",D.fillText(j,v,w),null!==g&&(D.font=A+"px sans-serif",D.fillStyle=p,D.textAlign="center",D.textBaseline="middle",D.fillText(g,v,w+x));const E=this._input;E.style.color=o,E.style.fontSize=B+"px"},resize:function(){const a=this._canvas;a.style.height="100%",a.style.width="100%",a.height=this._height,a.width=this._width},setProperty:function(a,b){this._properties[a]=b,this.redraw()},setValue:function(a){this.setValueFloating(a),this.commit()},setValueFloating:function(a){const b=this._properties,c=b.valMin,d=b.valMax;a<c?a=c:a>d&&(a=d),a=Math.round(a),this.setProperty("val",a)}},m=function(a,b){const c=a.target,d=c.scrollWidth,e=c.scrollHeight,f=a.offsetX,g=a.offsetY,h=b.angleStart,i=b.angleEnd,j=i-h;let k=Math.atan2(f-.5*d,-(g-.5*e))-h;const l=2*Math.PI;0>k&&(j>=l?k+=l:k=0);const m=b.valMin,n=b.valMax;let o=k/j*(n-m)+m;return o<m?o=m:o>n&&(o=n),o},n=function(a,b){const c=a.target,d=c.getBoundingClientRect(),e=d.left,f=d.top,g=c.scrollWidth,h=c.scrollHeight,i=a.targetTouches;let j=null;0<i.length&&(j=i.item(0));let k=0,l=0;if(null!==j){const a=j.pageX;k=a-e;const b=j.pageY;l=b-f}const m=k-.5*g,n=l-.5*h,o=b.angleStart,p=b.angleEnd,q=p-o,r=2*Math.PI;let s=Math.atan2(m,-n)-o;0>s&&(q>=r?s+=r:s=0);const t=b.valMin,u=b.valMax;let v=s/q*(u-t)+t;return v<t?v=t:v>u&&(v=u),v};return g.addEventListener("dblclick",function(a){const b=l._properties,c=b.readonly;if(!c){a.preventDefault();const b=l._inputDiv;b.style.display="block";const c=l._input;c.focus(),l.redraw()}}),g.addEventListener("mousedown",function(a){const b=a.buttons;if(1===b){const b=l._properties,c=b.readonly;if(!c){a.preventDefault();const c=m(a,b);l.setValueFloating(c)}l._mousebutton=!0}if(4===b){const b=l._properties,c=b.readonly;if(!c){a.preventDefault();const b=l._inputDiv;b.style.display="block";const c=l._input;c.focus(),l.redraw()}}}),g.addEventListener("mouseleave",function(){const a=l._mousebutton;a&&(l.abort(),l._mousebutton=!1)}),g.addEventListener("mousemove",function(a){const b=l._mousebutton;if(b){const b=l._properties,c=b.readonly;if(!c){a.preventDefault();const c=m(a,b);l.setValueFloating(c)}}}),g.addEventListener("mouseup",function(a){const b=l._mousebutton;if(b){const b=l._properties,c=b.readonly;if(!c){a.preventDefault();const c=m(a,b);l.setValue(c)}}l._mousebutton=!1}),g.addEventListener("resize",function(){l.redraw()}),g.addEventListener("touchstart",function(a){const b=l._properties,c=b.readonly;if(!c){const c=a.targetTouches,d=c.length;if(1===d){if(l._mousebutton=!0,0===l._touchCount){let b=l._timeoutDoubleTap;window.clearTimeout(b),b=window.setTimeout(function(){if(2===l._touchCount){const b=l._properties,c=b.readonly;if(!c){a.preventDefault();const b=l._inputDiv;b.style.display="block";const c=l._input;c.focus(),l.redraw()}}l._touchCount=0},500),l._timeoutDoubleTap=b}l._touchCount++;const c=n(a,b);l.setValueFloating(c)}}}),g.addEventListener("touchmove",function(a){const b=l._mousebutton;if(b){const b=l._properties,c=b.readonly;if(!c){const c=a.targetTouches,d=c.length;if(1===d){a.preventDefault();const c=n(a,b);l.setValueFloating(c)}}}}),g.addEventListener("touchend",function(a){const b=l._mousebutton;if(b){const b=l._properties,c=b.readonly;if(!c){const b=a.targetTouches,c=b.length;0===c&&(a.preventDefault(),l._mousebutton=!1,l.commit())}}l._mousebutton=!1}),g.addEventListener("touchcancel",function(){const a=l._mousebutton;if(a){l.abort(),l._touchCount=0;const a=l._timeoutDoubleTap;window.clearTimeout(a)}l._mousebutton=!1}),g.addEventListener("wheel",function(a){const b=l.getProperty("readonly");if(!b){a.preventDefault();const b=a.deltaY,c=0<b?1:0>b?-1:0;let d=l.getValue();d+=c,l.setValueFloating(d);let e=l._timeout;window.clearTimeout(e),e=window.setTimeout(function(){l.commit()},250),l._timeout=e}}),i.addEventListener("keypress",function(a){const b=a.keyCode;if(13===b||27===b){const c=l._inputDiv;c.style.display="none";const d=a.target;if(13===b){const a=l._properties,b=d.value,c=a.fnStringToValue,e=c(b),f=isFinite(e);f&&l.setValue(e)}d.value=""}}),l}}});const url="http://localhost:3000/",interval=100,connectedStr="Connected",disconnectedStr="Disconnected",tabs={};let currentTab=null;const contentDiv=document.getElementById("content"),titleDiv=document.getElementById("title"),loadingInfoDiv=document.getElementById("info"),isConnectedDiv=document.getElementById("isConnected"),tabBarDiv=document.getElementById("tab-bar"),HttpCodes={OK:200,NO_CONTENT:204,BAD_REQUEST:400,NOT_FOUND:404,PAYLOAD_TOO_LARGE:413};contentDiv.style.overflow="scroll",console.log(contentDiv.style.width);const parseJsonToHtmlElements=(e,n)=>{console.log("render");const o=e.components;n.forEach((n=>{if(isElementExistsOnOtherTabs(n,e))return void console.warn(`element ${n.name} on tab ${e.button.innerHTML} exists on other tabs - skipping it`);const t=o[n.name];switch(n.componentType){case"switch":null==t&&(o[n.name]=new SwitchComponent({name:n.name,componentType:n.componentType,size:n.size,posX:n.posX,posY:n.posY,value:n.value,color:n.color,desktopScale:n.desktopScale}));break;case"label":null==t?o[n.name]=new Label({name:n.name,componentType:n.componentType,posX:n.posX,posY:n.posY,value:n.value,fontSize:n.fontSize,isVertical:n.isVertical,color:n.color}):t.setState(n);break;case"gauge":null==t?o[n.name]=new GaugeComponent({name:n.name,componentType:n.componentType,posX:n.posX,posY:n.posY,width:n.width,height:n.height,color:n.color,maxValue:n.maxValue,minValue:n.minValue,value:n.value}):t.setState(n);break;case"indicator":null==t?o[n.name]=new LedIndicatorComponent({name:n.name,componentType:n.componentType,posX:n.posX,posY:n.posY,size:n.size,color:n.color,value:n.value}):t.setState(n);break;case"progressBar":null==t?o[n.name]=new ProgressBarComponent({name:n.name,componentType:n.componentType,posX:n.posX,posY:n.posY,width:n.width,height:n.height,color:n.color,isVertical:n.isVertical,value:n.value,minValue:n.minValue,maxValue:n.maxValue}):t.setState(n);break;case"field":null==t?o[n.name]=new ColorFieldComponent({name:n.name,componentType:n.componentType,posX:n.posX,posY:n.posY,width:n.width,height:n.height,color:n.color,outlineColor:n.outlineColor}):t.setState(n);break;case"image":null==t&&(o[n.name]=new ImageComponent({name:n.name,componentType:n.componentType,posX:n.posX,posY:n.posY,width:n.width,height:n.height,fileName:n.fileName}));break;case"slider":null==t&&(o[n.name]=new SliderComponent({name:n.name,componentType:n.componentType,posX:n.posX,posY:n.posY,width:n.width,height:n.height,color:n.color,maxValue:n.maxValue,minValue:n.minValue,value:n.value}));break;case"numberInput":null==t&&(o[n.name]=new NumberInputComponent({name:n.name,componentType:n.componentType,posX:n.posX,posY:n.posY,width:n.width,fontSize:n.fontSize,color:n.color,value:n.value}));break;case"textInput":null==t&&(o[n.name]=new TextInputComponent({name:n.name,componentType:n.componentType,posX:n.posX,posY:n.posY,width:n.width,fontSize:n.fontSize,color:n.color,value:n.value}));break;case"button":null==t&&(o[n.name]=new ButtonComponent({name:n.name,componentType:n.componentType,posX:n.posX,posY:n.posY,width:n.width,height:n.height,fontSize:n.fontSize,color:n.color,textColor:n.textColor,isVertical:n.isVertical,text:n.text}))}}))},isElementExistsOnOtherTabs=(e,n)=>{let o=!1;return Object.entries(tabs).forEach((([t,a])=>{a.components.hasOwnProperty(e.name)&&a!==n&&(o=!0)})),o},setIsConnectedDiv=e=>{!0===e?(isConnectedDiv.innerHTML="Connected",isConnectedDiv.style.color="#00a103",loadingInfoDiv.innerHTML=""):(isConnectedDiv.innerHTML="Disconnected",isConnectedDiv.style.color="#a10000")},initialFetch=()=>{fetch(`${url}init`).then((e=>e.text())).then((e=>{console.log(e),titleDiv.innerHTML=e.toString(),document.title=e.toString()}))};let isPendingRequest=!1;const getData=()=>{fetch(`${url}state`).then((e=>e.status===HttpCodes.OK?(console.log("OK"),e.json()):e.status===HttpCodes.NO_CONTENT?null:void 0)).then((e=>{null!==e&&(console.log(e),setIsConnectedDiv(!0),createTabs(e),renderTab(currentTab))})).catch((e=>{console.log(e),setIsConnectedDiv(!1)})),setTimeout(getData,100)};fetch(`${url}init`).then((e=>e.text())).then((e=>{console.log(e),titleDiv.innerHTML=e.toString(),document.title=e.toString()})),getData();
const appendTab=t=>{if(t in tabs)return;const e=createTabButton(t);tabBarDiv.appendChild(e),tabs[t]={button:e,components:{},htmlElement:document.createElement("span")}},createTabButton=t=>{const e=document.createElement("button");return e.innerHTML=t,e.classList.add("tab-button"),e.addEventListener("click",(t=>{const e=t.target.innerHTML;t.target.disabled||onTabSwitch(e)})),e},setTabButtonIsDisabled=(t,e)=>{e?t.button.classList.add("tab-button-disabled"):t.button.classList.remove("tab-button-disabled")},onTabSwitch=t=>{const e=tabs[t];e!==currentTab&&(contentDiv.removeChild(currentTab.htmlElement),currentTab.button.disabled=!1,setTabButtonIsDisabled(currentTab,!1),setTabButtonIsDisabled(e,!0),currentTab=e,contentDiv.appendChild(currentTab.htmlElement),currentTab.button.disabled=!0)},createTabs=t=>{Object.entries(t).forEach((([t,e])=>{appendTab(t),parseJsonToHtmlElements(tabs[t],e),null===currentTab&&(currentTab=tabs[t],switchTab(currentTab))}))},renderTab=t=>{Object.entries(t.components).forEach((([e,n])=>{null===document.getElementById(n.name)&&t.htmlElement.appendChild(n.render())}))},switchTab=t=>{contentDiv.contains(currentTab.htmlElement)&&contentDiv.removeChild(currentTab.htmlElement),contentDiv.appendChild(t.htmlElement),setTabButtonIsDisabled(currentTab,!1),currentTab=t,setTabButtonIsDisabled(currentTab,!0)};
const componentWrapperClassName = "c-wrapper";
const successColor = "#00b80c";
const strToVertical = (str) => {
  let newStr = "";
  for (let i = 0; i < str.length; i++) {
    newStr += `${str.charAt(i)}<br/>`;
  }
  return newStr;
};
class Component {
  constructor({ name, componentType, posX, posY, value }) {
    this.name = name;
    this.componentType = componentType;
    this.posX = posX;
    this.posY = posY;
    this.value = value;
    this.wrapper = document.createElement("div");
    this.dFragment = document.createDocumentFragment();
  }
  setState(state) {
    this.value = state.value;
  }
  render() {
    this.wrapper.id = this.name;
    this.wrapper.className = componentWrapperClassName;
    this.wrapper.style.position = "absolute";
    this.wrapper.style.top = `${this.posY + 82}px`; //topbar offset
    this.wrapper.style.left = `${this.posX}px`;
  }
}

class InputComponent extends Component {
  constructor({ name, componentType, posX, posY, value }) {
    super({ name, componentType, posX, posY, value });
  }
  toJson() {
    return {
      name: this.name,
      componentType: this.componentType,
      value: this.value,
    };
  }

  notifyAboutSendingStatus(color) {}

  async sendData() {
    console.log(this.toJson());
    const res = await fetch(`${url}input`, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify(this.toJson()),
    });
    return res.clone();
  }
}

class OutputComponent extends Component {
  constructor({ name, componentType, posX, posY, value }) {
    super({ name, componentType, posX, posY, value });
  }
}

class Label extends OutputComponent {
  constructor({
    name,
    componentType,
    posX,
    posY,
    value,
    fontSize,
    color,
    isVertical,
  }) {
    super({ name, componentType, posX, posY, value });
    if (typeof value !== "string")
      throw `${this.toString()} Illegal Parameter Type`;
    this.fontSize = fontSize;
    this.color = color;
    this.setState({ fontSize, color, value });
    this.isVertical = isVertical;
    if (this.isVertical) this.value = strToVertical(this.value);
  }

  setState(state) {
    super.setState(state);
    this.fontSize = state.fontSize;
    this.color = state.color;
    if (this.isVertical) this.value = strToVertical(this.value);
    this.wrapper.innerHTML = this.value;
    this.wrapper.style.fontSize = `${this.fontSize}px`;
    this.wrapper.style.color = this.color;
  }

  render() {
    super.render();
    this.wrapper.style.fontSize = this.fontSize;
    this.wrapper.style.color = this.color;
    this.wrapper.innerHTML = this.value;
    this.dFragment.appendChild(this.wrapper);
    return this.dFragment;
  }
}

class GaugeComponent extends OutputComponent {
  constructor({
    name,
    componentType,
    posX,
    posY,
    value,
    color,
    minValue,
    maxValue,
    width,
    height,
  }) {
    super({ name, componentType, posX, posY, value });

    this.color = color;
    this.minValue = minValue;
    this.maxValue = maxValue;
    this.width = width;
    this.height = height;

    this.knob = pureknob.createKnob(this.width, this.height);
    this.knob.setProperty("label", this.name);
    this.knob.setProperty("colorLabel", "#333");
    this.knob.setProperty("angleStart", -0.75 * Math.PI);
    this.knob.setProperty("angleEnd", 0.75 * Math.PI);
    this.knob.setProperty("colorFG", this.color);
    this.knob.setProperty("colorBG", "#aaa");
    this.knob.setProperty("trackWidth", 0.4);
    this.knob.setProperty("valMin", this.minValue);
    this.knob.setProperty("valMax", this.maxValue);
    this.knob.setProperty("readonly", true);
    this.knob.setValue(this.value);
  }
  setState(state) {
    super.setState(state);
    this.color = state.color;
    this.knob.setProperty("colorFG", this.color);
    this.knob.setValue(this.value);
  }

  render() {
    super.render();
    this.wrapper.appendChild(this.knob.node());
    this.dFragment.appendChild(this.wrapper);
    return this.dFragment;
  }
}

class LedIndicatorComponent extends OutputComponent {
  constructor({ name, componentType, posX, posY, value, color, size }) {
    super({ name, componentType, posX, posY, value });
    this.color = color;
    this.size = size;
    this.inner = document.createElement("div");
    this.outer = document.createElement("div");

    this.innerClassName = "inner-led";
    this.outerClassName = "outer-led";
    this.outerToInnerSizeFactor = 5 / 9;
    this.offColor = "#777";
    this.outerColor = "#555";
    this.innerSize = Math.round(this.size * this.outerToInnerSizeFactor);
  }
  setState(state) {
    super.setState(state);
    this.color = state.color;
    this.setLed(state.value);
  }
  setLed(value) {
    if (value) {
      this.inner.style.backgroundColor = this.color;
      this.inner.style.boxShadow = `0 0 ${Math.round(this.innerSize / 3)}px ${
        this.color
      }`;
    } else {
      this.inner.style.backgroundColor = this.offColor;
      this.inner.style.boxShadow = `none`;
    }
  }

  render() {
    super.render();
    this.outer.className = this.outerClassName;
    this.inner.className = this.innerClassName;
    this.outer.style.width = `${this.size}px`;
    this.outer.style.height = `${this.size}px`;
    this.outer.style.backgroundColor = this.outerColor;
    this.inner.style.width = `${this.innerSize}px`;
    this.inner.style.height = `${this.innerSize}px`;
    this.setLed(this.value);

    this.outer.appendChild(this.inner);
    this.wrapper.appendChild(this.outer);
    this.dFragment.appendChild(this.wrapper);
    return this.dFragment;
  }
}

class ProgressBarComponent extends OutputComponent {
  constructor({
    name,
    componentType,
    posX,
    posY,
    value,
    maxValue,
    minValue,
    width,
    height,
    color,
    isVertical,
  }) {
    super({ name, componentType, posX, posY, value });
    this.progressBarClassname = "progress-bar";
    this.maxValue = maxValue;
    this.minValue = minValue;
    this.width = width;
    this.height = height;
    this.color = color;
    this.isVertical = isVertical;
    this.progressBar = document.createElement("progress");
    this.style = document.createElement("style");
  }
  setState(state) {
    super.setState(state);
    this.color = state.color;
    this.progressBar.value = this.value;
    this.updateColor();
  }
  updateColor() {
    this.style.innerHTML = `.${this.name}::-webkit-progress-value{background-color: ${this.color};}
                               .${this.name}::-moz-progress-bar{background-color: ${this.color};}`;
  }
  render() {
    super.render();
    this.progressBar.classList.add(this.progressBarClassname);
    this.progressBar.classList.add(this.name); // second unique class to webkit styles
    this.progressBar.max = this.maxValue;
    this.progressBar.min = this.minValue;
    this.progressBar.value = this.value;
    this.progressBar.style.width = `${this.width}px`;
    this.progressBar.style.height = `${this.height}px`;
    if (this.isVertical) this.wrapper.style.transform = "rotate(-90deg)";
    this.updateColor();
    this.wrapper.appendChild(this.progressBar);
    this.wrapper.appendChild(this.style);
    this.dFragment.appendChild(this.wrapper);
    return this.dFragment;
  }
}
class ColorFieldComponent extends OutputComponent {
  constructor({
    name,
    componentType,
    posX,
    posY,
    width,
    height,
    color,
    outlineColor,
  }) {
    super({ name, componentType, posX, posY });
    this.fieldClassName = "color-field";
    this.width = width;
    this.height = height;
    this.color = color;
    this.outlineColor = outlineColor;
    this.outlineOffset = 2;
  }
  setState(state) {
    this.color = state.color;
    this.wrapper.style.backgroundColor = this.color;
  }
  render() {
    super.render();
    this.wrapper.classList.add(this.fieldClassName);
    this.wrapper.style.zIndex = "0";
    this.wrapper.style.width = `${this.width - this.outlineOffset}px`;
    this.wrapper.style.height = `${this.height - this.outlineOffset}px`;
    this.wrapper.style.backgroundColor = this.color;
    this.wrapper.style.outline = `1px solid ${this.outlineColor}`;
    this.dFragment.appendChild(this.wrapper);
    return this.dFragment;
  }
}

class ImageComponent extends OutputComponent {
  constructor({ name, componentType, posX, posY, width, height, fileName }) {
    super({ name, componentType, posX, posY });
    this.imageClassName = "background-image";
    this.width = width;
    this.height = height;
    this.isFileLoaded = false;
    this.fileName = fileName;
    this.imageEl = document.createElement("img");
    this.loadFile();
  }

  loadFile() {
    fetch(`${url}image?fileName=/images/${this.fileName}`)
      .then((response) => {
        console.log("image response");
        switch (response.status) {
          case HttpCodes.NOT_FOUND:
            throw new Error(`Image ${this.fileName} doesn't exist`);
            break;
          case HttpCodes.PAYLOAD_TOO_LARGE:
            throw new Error(
              `Image ${this.fileName} is too big to be processed by device`
            );
            break;
          case HttpCodes.BAD_REQUEST:
            throw new Error(`File name not provided`);
            break;
          case HttpCodes.OK:
            return response.blob();
            break;
        }
      })
      .then((blob) => {
        this.imageEl.src = URL.createObjectURL(blob);
        this.isFileLoaded = true;
      });
  }

  render() {
    super.render();
    this.wrapper.style.zIndex = "0";
    this.imageEl.style.zIndex = "0";
    if (this.height != 0) this.imageEl.width = this.width;
    if (this.width != 0) this.imageEl.height = this.height;

    this.wrapper.appendChild(this.imageEl);
    this.dFragment.appendChild(this.wrapper);
    return this.dFragment;
  }
}

class SwitchComponent extends InputComponent {
  constructor({ name, componentType, posX, posY, value, color, size }) {
    super({ name, componentType, posX, posY, value });
    if (typeof value !== "boolean")
      throw `Switch ${this.toString()} Illegal Value Type`;
    this.switchCheckBoxClassName = "onoffswitch-checkbox";
    this.checkBox = document.createElement("input");
    this.color = color;
    this.size = size;
  }
  onClick(e) {
    console.log(e.target.checked);
    this.setState({ value: e.target.checked });
    super.sendData();
  }
  render() {
    super.render();
    this.checkBox.type = "checkbox";
    this.checkBox.className = this.switchCheckBoxClassName + this.name;
    this.checkBox.style.width = `${this.size}px`;
    this.checkBox.style.height = `${this.size}px`;
    this.checkBox.addEventListener("change", (e) => {
      this.onClick(e);
    });
    this.wrapper.appendChild(this.checkBox);
    this.dFragment.appendChild(this.wrapper);
    return this.dFragment;
  }
}

class SliderComponent extends InputComponent {
  constructor({
    name,
    componentType,
    width,
    height,
    posX,
    posY,
    value,
    color,
    maxValue,
    minValue,
  }) {
    super({ name, componentType, width, height, posX, posY, value });
    this.sliderClassName = "slider";
    this.sliderValueWrapperClassName = "sliderValueWrapper";
    this.minValue = minValue;
    this.maxValue = maxValue;
    this.color = color;
    this.width = width;
    this.height = height;
    this.slider = document.createElement("input");
    this.style = document.createElement("style");
    this.sliderValueWrapper = document.createElement("span");
  }
  notifyAboutSendingStatus(color) {
    this.slider.style.outline = `1px solid ${color}`;
    setTimeout(() => {
      this.slider.style.outline = `none`;
    }, 500);
  }
  setIsScrollingEnabled(state) {
    content.style.overflow = state ? "scroll" : "hidden";
  }
  onChange(e) {
    this.setIsScrollingEnabled(false);
    this.sliderValueWrapper.innerHTML = e.target.value;
    this.setState({ value: parseInt(e.target.value) });
    setTimeout(() => {
      this.setIsScrollingEnabled(true);
    }, 5000);
  }
  onRelease(e) {
    this.setIsScrollingEnabled(true);
    this.setState({ value: parseInt(e.target.value) });
    this.sendData().then((data) => {
      if (data.status === 200) this.notifyAboutSendingStatus(successColor);
      else this.notifyAboutSendingStatus("red");
    });
  }
  render() {
    super.render();

    this.wrapper.style.display = "flex";
    this.wrapper.style.flexDirection = "column";
    this.wrapper.style.alignItems = "center";
    this.slider.type = "range";
    this.slider.classList.add(this.sliderClassName);
    this.slider.classList.add(`${this.name}`); // second, unique class is required because modifying thumb via id is not working
    this.slider.max = this.maxValue;
    this.slider.min = this.minValue;
    this.slider.style.background = "#333";
    this.slider.value = this.value;
    this.slider.style.width = this.width + "px";
    this.slider.style.height = this.height + "px";
    this.slider.addEventListener("input", (e) => this.onChange(e));
    this.slider.addEventListener("change", (e) => this.onRelease(e));
    //append style to slider thumb (Chrome/Firefox)
    this.style.innerHTML = `.${this.name}::-webkit-slider-thumb {background: ${
      this.color
    }; height: ${this.height * 1.1 + "px"}; width: ${this.height * 1.1 + "px"};}
                                .${this.name}::-moz-range-thumb {background: ${
      this.color
    }; height: ${this.height * 1.1 + "px"}; width: ${
      this.height * 1.1 + "px"
    };}`;
    this.sliderValueWrapper.className = this.sliderValueWrapperClassName;
    this.sliderValueWrapper.innerHTML = this.value;

    this.wrapper.appendChild(this.style);
    this.wrapper.appendChild(this.slider);
    this.wrapper.appendChild(this.sliderValueWrapper);
    this.dFragment.appendChild(this.wrapper);
    return this.dFragment;
  }
}

class NumberInputComponent extends InputComponent {
  constructor({
    name,
    componentType,
    posX,
    posY,
    value,
    fontSize,
    width,
    color,
  }) {
    super({ name, componentType, posX, posY, value });
    if (typeof value !== "number")
      throw `Number Input ${this.toString()} Illegal Value Type`;
    this.inputClassName = "input";
    this.width = width;
    this.fontSize = fontSize;
    this.color = color;
    this.input = document.createElement("input");
  }
  onSubmit(e) {
    this.setState({ value: parseFloat(this.input.value) });
    this.sendData().then((data) => {
      if (data.status === 200) this.notifyAboutSendingStatus(successColor);
      else this.notifyAboutSendingStatus("red");
    });
  }
  setColor(color) {
    this.input.style.borderBottom = `solid 4px ${color}`;
  }

  notifyAboutSendingStatus(color) {
    this.setColor(color);
    setTimeout(() => {
      this.setColor(this.color);
    }, 500);
  }

  render() {
    super.render();
    this.input.className = this.inputClassName;

    this.wrapper.style.display = "flex";
    this.wrapper.style.flexDirection = "row";
    this.wrapper.style.justifyContent = "center";
    this.wrapper.style.alignItems = "center";

    this.input.type = "number";
    this.input.value = this.value;
    this.input.style.width = `${this.width}px`;
    this.input.style.fontSize = `${this.fontSize}px`;
    this.input.style.color = this.color;
    this.input.style.borderBottom = `solid 3px ${this.color}`;
    this.input.addEventListener("focusout", (e) => {
      e.target.style.borderBottom = `solid 3px ${this.color}`;
    });
    this.input.addEventListener("focus", (e) => {
      e.target.style.borderBottom = `solid 4px ${this.color}`;
    });
    this.input.addEventListener("change", (e) => {
      this.onSubmit(e);
    });
    this.input.placeholder = this.name;

    this.wrapper.appendChild(this.input);
    this.dFragment.appendChild(this.wrapper);
    return this.dFragment;
  }
}

class TextInputComponent extends InputComponent {
  constructor({
    name,
    componentType,
    posX,
    posY,
    value,
    fontSize,
    width,
    color,
  }) {
    super({ name, componentType, posX, posY, value });
    if (typeof value !== "string")
      throw new TypeError(`Text Input ${this.toString()} Illegal Value Type`);
    this.inputClassName = "input";
    this.width = width;
    this.fontSize = fontSize;
    this.color = color;
    this.input = document.createElement("input");
  }

  onSubmit(e) {
    this.setState({ value: String(this.input.value) });
    this.sendData().then((data) => {
      if (data.status === 200) this.notifyAboutSendingStatus(successColor);
      else this.notifyAboutSendingStatus("red");
    });
  }
  setColor(color) {
    this.input.style.borderBottom = `solid 4px ${color}`;
  }

  notifyAboutSendingStatus(color) {
    this.setColor(color);
    setTimeout(() => {
      this.setColor(this.color);
    }, 500);
  }

  render() {
    super.render();
    this.input.className = this.inputClassName;
    this.wrapper.style.display = "flex";
    this.wrapper.style.flexDirection = "row";
    this.wrapper.style.justifyContent = "center";
    this.wrapper.style.alignItems = "center";

    this.input.type = "text";

    this.input.value = this.value;
    this.input.style.width = `${this.width}px`;
    this.input.style.fontSize = `${this.fontSize}px`;
    this.input.style.color = this.color;
    this.input.style.borderBottom = `solid 3px ${this.color}`;

    this.input.addEventListener("focusout", (e) => {
      e.target.style.borderBottom = `solid 3px ${this.color}`;
    });
    this.input.addEventListener("focus", (e) => {
      e.target.style.borderBottom = `solid 4px ${this.color}`;
    });
    this.input.addEventListener("change", (e) => {
      this.onSubmit(e);
    });

    this.input.placeholder = this.name;

    this.wrapper.appendChild(this.input);
    this.dFragment.appendChild(this.wrapper);
    return this.dFragment;
  }
}

class ButtonComponent extends InputComponent {
  constructor({
    name,
    componentType,
    posX,
    posY,
    value,
    color,
    text,
    textColor,
    fontSize,
    width,
    height,
    isVertical,
  }) {
    super({ name, componentType, posX, posY, value });
    this.buttonClassName = "button";
    this.isButtonPressed = false;
    this.color = color;
    this.text = text;
    this.fontSize = fontSize;
    this.textColor = textColor;
    this.width = width;
    this.height = height;
    if (isVertical) this.text = strToVertical(this.text);
    this.button = document.createElement("button");
  }

  notifyAboutSendingStatus(color) {
    this.button.style.boxShadow = `0px 0px 0px 5px ${color}`;
  }

  deleteNotifyingShadow() {
    this.button.style.boxShadow = "none";
  }

  onClick(e) {
    this.isButtonPressed = true;
    this.value = true;
    const send = () => {
      this.sendData().then((res) => {
        if (res.status === 200) this.notifyAboutSendingStatus("white");
        else this.notifyAboutSendingStatus("red");
        if (!this.isButtonPressed) this.deleteNotifyingShadow();
      });
      if (this.isButtonPressed) setTimeout(send, 100);
      else this.deleteNotifyingShadow();
    };
    send();
  }
  onRelease(e) {
    this.isButtonPressed = false;
    this.value = false;
    this.sendData();
  }
  onMouseOut(e) {
    if (this.isButtonPressed) {
      this.isButtonPressed = false;
      this.value = false;
      this.sendData();
    }
  }
  render() {
    super.render();
    this.button.className = this.buttonClassName;
    this.button.innerHTML = this.text;
    this.button.style.fontSize = `${this.fontSize}px`;
    this.button.style.color = this.textColor;
    this.button.style.backgroundColor = this.color;
    this.button.style.width = `${this.width}px`;
    this.button.style.height = `${this.height}px`;
    this.button.addEventListener("mousedown", (e) => {
      this.onClick(e);
    });
    this.button.addEventListener("click", (e) => {
      this.onRelease(e);
    });
    this.button.addEventListener("mouseout", (e) => {
      this.onMouseOut(e);
    });
    this.button.addEventListener(
      "touchstart",
      (e) => {
        this.onClick(e);
      },
      false
    );
    this.button.addEventListener(
      "touchend",
      (e) => {
        this.onRelease(e);
      },
      false
    );

    this.wrapper.appendChild(this.button);
    this.dFragment.appendChild(this.wrapper);
    return this.dFragment;
  }
}


	</script>

</body>
</html>